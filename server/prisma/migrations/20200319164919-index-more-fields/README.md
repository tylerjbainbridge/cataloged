# Migration `20200319164919-index-more-fields`

This migration has been generated by Tyler Bainbridge at 3/19/2020, 4:49:19 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."File.title_description"

DROP INDEX "public"."Item.type"

DROP INDEX "public"."Note.title"

ALTER TABLE "public"."CollectionBlock" DROP CONSTRAINT IF EXiSTS "CollectionBlock_collection_fkey";

ALTER TABLE "public"."CollectionEntry" DROP CONSTRAINT IF EXiSTS "CollectionEntry_collection_fkey";

ALTER TABLE "public"."File" DROP CONSTRAINT IF EXiSTS "File_item_fkey",
DROP CONSTRAINT IF EXiSTS "File_uploadGroup_fkey",
DROP CONSTRAINT IF EXiSTS "File_user_fkey";

ALTER TABLE "public"."GoogleAccount" DROP CONSTRAINT IF EXiSTS "GoogleAccount_user_fkey";

ALTER TABLE "public"."GoogleContact" DROP CONSTRAINT IF EXiSTS "GoogleContact_googleAccount_fkey",
DROP CONSTRAINT IF EXiSTS "GoogleContact_item_fkey",
DROP CONSTRAINT IF EXiSTS "GoogleContact_user_fkey";

ALTER TABLE "public"."Label" DROP CONSTRAINT IF EXiSTS "Label_user_fkey";

ALTER TABLE "public"."Link" DROP CONSTRAINT IF EXiSTS "Link_user_fkey";

ALTER TABLE "public"."Note" DROP CONSTRAINT IF EXiSTS "Note_user_fkey";

ALTER TABLE "public"."ShareLink" DROP CONSTRAINT IF EXiSTS "ShareLink_user_fkey";

ALTER TABLE "public"."UploadGroup" DROP CONSTRAINT IF EXiSTS "UploadGroup_user_fkey";

CREATE  INDEX "_CollectionToItem_B_index" ON "public"."_CollectionToItem"("B")

CREATE  INDEX "File.name_title_description_extension_isUploaded_isFailed" ON "public"."File"("name","title","description","extension","isUploaded","isFailed")

CREATE  INDEX "Item.type_status_isFavorited_deletedAt" ON "public"."Item"("type","status","isFavorited","deletedAt")

CREATE  INDEX "_ItemToLabel_B_index" ON "public"."_ItemToLabel"("B")

CREATE  INDEX "Note.title_text" ON "public"."Note"("title","text")

ALTER TABLE "public"."CollectionBlock" ADD FOREIGN KEY ("collection")REFERENCES "public"."Collection"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CollectionEntry" ADD FOREIGN KEY ("collection")REFERENCES "public"."Collection"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("item")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("uploadGroup")REFERENCES "public"."UploadGroup"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."GoogleAccount" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."GoogleContact" ADD FOREIGN KEY ("googleAccount")REFERENCES "public"."GoogleAccount"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."GoogleContact" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."GoogleContact" ADD FOREIGN KEY ("item")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Label" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Link" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ShareLink" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."UploadGroup" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200305175450-int-size..20200319164919-index-more-fields
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRESQL_URL")
 }
 model InviteCode {
   id String @id @default(cuid())
@@ -50,10 +50,9 @@
   uploadGroup UploadGroup
   user        User
   width       Int?
-  @@index([title, description])
-
+  @@index([name, title, description, extension, isUploaded, isFailed])
 }
 model GoogleAccount {
   id        String   @id @default(cuid())
@@ -194,8 +193,9 @@
   id        String   @id @default(cuid())
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
+
   deletedAt DateTime?
   isFavorited Boolean @default(false)
   status      String? @default("NOT_STARTED")
@@ -214,9 +214,9 @@
   labels      Label[]
   collections Collection[]
-  @@index([type])
+  @@index([type, status, isFavorited, deletedAt])
 }
 model Label {
   id        String   @id @default(cuid())
@@ -262,9 +262,9 @@
   user User
   item Item?
-  @@index([title])
+  @@index([title, text])
 }
 model UploadGroup {
   id        String   @id @default(cuid())
```


