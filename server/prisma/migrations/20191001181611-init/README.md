# Migration `20191001181611-init`

This migration has been generated by Tyler Bainbridge at 10/1/2019, 6:16:11 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
  "email" text NOT NULL DEFAULT '' ,
  "firstName" text   ,
  "id" text NOT NULL  ,
  "lastName" text   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Collection" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Item" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "type" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Link" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text   ,
  "favicon" text   ,
  "href" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "image" text   ,
  "notes" text NOT NULL DEFAULT '' ,
  "title" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."File" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "extension" text NOT NULL DEFAULT '' ,
  "height" integer   ,
  "id" text NOT NULL  ,
  "isFailed" boolean NOT NULL DEFAULT false ,
  "isUploaded" boolean NOT NULL DEFAULT false ,
  "name" text NOT NULL DEFAULT '' ,
  "size" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "width" integer   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."UploadGroup" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "isComplete" boolean NOT NULL DEFAULT false ,
  "isFailed" boolean NOT NULL DEFAULT false ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."GoogleAccount" (
  "accountId" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text   ,
  "firstName" text   ,
  "id" text NOT NULL  ,
  "lastName" text   ,
  "picture" text   ,
  "refreshToken" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."_CollectionToItem" (
  "A" text   REFERENCES "public"."Collection"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "public"."Item"("id") ON DELETE CASCADE
);

ALTER TABLE "public"."Collection" ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Item" ADD COLUMN "link" text   REFERENCES "public"."Link"("id") ON DELETE SET NULL,
ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Link" ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."File" ADD COLUMN "item" text   REFERENCES "public"."Item"("id") ON DELETE SET NULL,
ADD COLUMN "uploadGroup" text   REFERENCES "public"."UploadGroup"("id") ON DELETE SET NULL,
ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."UploadGroup" ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."GoogleAccount" ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.id" ON "public"."User"("id")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Collection.id" ON "public"."Collection"("id")

CREATE UNIQUE INDEX "Item.id" ON "public"."Item"("id")

CREATE UNIQUE INDEX "Link.id" ON "public"."Link"("id")

CREATE UNIQUE INDEX "File.id" ON "public"."File"("id")

CREATE UNIQUE INDEX "UploadGroup.id" ON "public"."UploadGroup"("id")

CREATE UNIQUE INDEX "GoogleAccount.id" ON "public"."GoogleAccount"("id")

CREATE UNIQUE INDEX "GoogleAccount.accountId" ON "public"."GoogleAccount"("accountId")

CREATE UNIQUE INDEX "_CollectionToItem_AB_unique" ON "public"."_CollectionToItem"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191001181611-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,120 @@
+datasource db {
+  provider = "postgres"
+  url      = env("POSTGRESQL_URL")
+  default  = true
+}
+
+generator photon {
+  provider = "photonjs"
+}
+
+generator nexus_prisma {
+  provider = "nexus-prisma"
+}
+
+model User {
+  id        String  @default(cuid()) @id @unique
+  email     String  @unique
+  firstName String?
+  lastName  String?
+
+  googleAccounts GoogleAccount[]
+  items          Item[]
+  collections    Collection[]
+  files          File[]
+  links          Link[]
+  uploadGroups   UploadGroup[]
+}
+
+model Collection {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name String
+
+  user  User
+  items Item[]
+}
+
+model Item {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  type String
+
+  file File?
+  link Link?
+
+  collections Collection[]
+}
+
+
+model Link {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  href String
+
+  // Meta
+  title       String?
+  description String?
+  image       String?
+  favicon     String?
+
+  notes String
+
+  item Item
+  user User
+}
+
+model File {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name      String
+  extension String
+  size      String?
+
+  width  Int?
+  height Int?
+
+
+  isUploaded Boolean
+  isFailed   Boolean
+
+  item        Item
+  user        User
+  uploadGroup UploadGroup
+}
+
+model UploadGroup {
+  id        String   @default(cuid()) @id @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  isComplete Boolean
+  isFailed   Boolean
+
+  user  User
+  files File[]
+}
+
+model GoogleAccount {
+  id String @default(cuid()) @id @unique
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  accountId    String? @unique
+  email        String?
+  firstName    String?
+  lastName     String?
+  picture      String?
+  refreshToken String?
+
+  user User
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191001181611-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191001181611-init'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
